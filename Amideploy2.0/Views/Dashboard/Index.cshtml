@{
    ViewBag.Title = "AMI DEPLOY";
}

<h2 class="text-center">Dashboard</h2>
<br />
<br />
<link href="~/Content/bootstrap.css" rel="stylesheet" />
<div class="container">
    <div class="row justify-content-start">
        <div class="col-4">
            @Html.DropDownList("components",
      (IEnumerable
    <SelectListItem>)ViewBag.Components,
      new { @class = "selectpicker required", multiple = "multiple", data_live_search = "true", data_selected_text_format = "count > 3", data_style = "btn-primary", data_width = "auto" })
        </div>
        <div class="col-4"><button id="submit" class="btn btn-primary">Get Data</button></div>
    </div>





    <br />
    <div class="row">
        <table id="Deployementdata" class="table table-striped table-bordered dt-responsive nowrap" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th>Component Name</th>
                    <th>DEV</th>
                    <th>LT</th>
                    <th>QA</th>
                    <th>PROD</th>
                </tr>
            </thead>

        </table>
        
        @section Scripts{
            

            <script>
                $(document).ready(function () {
                    $("#Deployementdata").hide();
                    $('select').selectpicker();
                    $('#submit').click(function (e) {
                        e.preventDefault();
                        var selectedComponents = $('#components').val();
                        if (selectedComponents != null)
                        {
                            $("#Deployementdata").show();
                            $('#Deployementdata').DataTable(
                                {
                                    "ordering": false,
                                    "paging": true,
                                    "destroy": true,
                                    "processing": false, // for show progress bar
                                    "serverSide": false, // for process server side
                                    "filter": true, // this is for disable filter (search box)
                                    "orderMulti": false, // for disable multiple column at once
                                    "ajax": {
                                        "url": "/Dashboard/Getdeployementdata",
                                        "content": "application/json",
                                        "type": "POST",
                                        "datatype": "json",
                                        "data": { selectedComponents: selectedComponents },
                                        "error": function (error) {
                                            console.log(error)
                                            window.location.href = "/Account/Index";
                                        }
                                    },
                                    "language": {
                                        "emptyTable": "No record found.",
                                        "processing":
                                            '<i class="fa fa-spinner fa-spin fa-3x fa-fw" style="color:#2a2b2b;"></i><span class="sr-only" style="font-size: 50px; !important">Loading...</span> '
                                    },
                                    "columns": [
                                        { "data": "ComponentName" },
                                        {
                                            "data": "DEV",

                                            "render": function (DEV, type, row, meta) {
                                                arr = DEV.split(",")
                                                data = '<a href=/Dashboard/Getbuildlog?env=LT&component=' + row["ComponentName"] + '&version=' + arr[0] + ' target="_blank">' + DEV.split(",").join("<br/>") + '</a>';
                                                return data;
                                            }

                                        },
                                        {
                                            "data": "LT"

                                            ,
                                            "render": function (LT, type, row, meta) {
                                                arr = LT.split(",")
                                                data = '<a href=/Dashboard/Getbuildlog?env=LT&component=' + row["ComponentName"] + '&version=' + arr[0] + ' target="_blank">' + LT.split(",").join("<br/>") + '</a>';
                                                return data;
                                            }

                                        },
                                        {
                                            "data": "QA"
                                            ,
                                            "render": function (QA, type, row, meta) {
                                                arr = QA.split(",")
                                                data = '<a href=/Dashboard/Getbuildlog?env=QA&component=' + row["ComponentName"] + '&version=' + arr[0] + '" target="_blank">' + QA.split(",").join("<br/>") + '</a>';
                                                return data;
                                            }
                                        },
                                        {
                                            "data": "PROD",
                                            "render": function (PROD, type, row, meta) {
                                                arr = PROD.split(",")
                                                data = '<a href=/Dashboard/Getbuildlog?env=PROD&component=' + row["ComponentName"] + '&version=' + arr[0] + ' target="_blank">' + PROD.split(",").join("<br/>") + '</a>';
                                                return data;
                                            }
                                        }

                                    ],
                                    "columnDefs": [{
                                        "targets": '_all',
                                        "defaultContent": ""
                                    }]
                                });
                        }
                    })

                })
            </script>
        }
    </div>
</div>